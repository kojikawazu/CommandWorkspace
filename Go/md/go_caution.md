# Go言語の注意点まとめ

## トランザクション処理

Go(Echo)を使用する前提。

- 以下の事から、現在のデータベース操作ではトランザクション処理は難しい。
  - SupabaseのREST APIを使っているため、トランザクション処理を行うことができない。
  - try~catchの排他ロックも現実的ではない。

- 解決策としては以下がある。
  - SupabaseのREST APIを使わずにデータベースに直接アクセスする。
  - その為にはSupabase側のストアドプロシージャ(関数)を作成し、Go(Echo)側はその関数を利用する。
  
他の方法もある。

- Supabaseデータベースへの直接接続する

- 1. データベース接続情報の取得
  - Supabaseダッシュボードにログインし、プロジェクトを選択する。
  - 左側のメニューから「Settings（設定）」をクリックし、その中の「Database」を選択する。
  - 「Connection string」または「Database URL」の項目で、データベースへの接続情報が提供されている。

- 2. Goアプリケーションからの接続
  - Go言語の標準パッケージdatabase/sqlと、PostgreSQL用のドライバ（例：github.com/lib/pqやgithub.com/jackc/pgx）を使用する。 

### 直接接続するメリットとデメリット

- メリット
  - トランザクションの制御：Goコード内でトランザクションを開始・終了し、複数の操作を一つのトランザクションとしてまとめることができる。
  - ロックの使用：アドバイザリーロックなど、データベースのロック機能を直接利用できる。
  - 柔軟なクエリ：複雑なクエリやカスタムのSQL操作が可能となる。

- デメリット
  - セキュリティリスク：接続情報の管理やアクセス制御を適切に行わないと、セキュリティ上のリスクが高まる。
  - Supabaseの機能を活用できない：認証、RLS、APIキー管理など、Supabaseが提供する一部の機能をバイパスすることとなる。
  - メンテナンスの負荷：データベーススキーマの変更やマイグレーションの管理が複雑になる可能性がある。